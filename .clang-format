---
# Base on Google Style and project instructions (@instructions.mdc)
BasedOnStyle: Google
Language: Cpp
Standard: c++17

# Line length and indentations
ColumnLimit: 80
IndentWidth: 2
TabWidth: 2
UseTab: Never
AccessModifierOffset: -1
ConstructorInitializerIndentWidth: 4
ContinuationIndentWidth: 4

# Braces and arguments
BreakBeforeBraces: Attach
AlignAfterOpenBracket: Align
AllowAllArgumentsOnNextLine: true
AllowAllParametersOfDeclarationOnNextLine: true

# Include sorting (Aligned with @instructions.mdc)
SortIncludes: true
IncludeBlocks: Regroup
IncludeCategories:
  # 1. Related Header (specific path for .cc files, less relevant in .h/.hpp)
  # This regex is tricky. Let's assume project headers cover this for now,
  # relying on clang-format's default behavior for the very first #include.
  # A more complex setup might be needed if issues persist.
  # We prioritize project headers generally here.

  # 2. C system headers
  - Regex:           '^<sys/.*\.h>|^<unistd\.h>|^<linux/.*\.h>|^<arpa/.*\.h>|^<netinet/.*\.h>'
    Priority:        2
  # 3. C++ standard library headers (including <c...> headers)
  - Regex:           '^<(c(assert|complex|ctype|errno|fenv|float|inttypes|iso646|limits|locale|math|setjmp|signal|stdalign|stdarg|stdatomic|stdbool|stddef|stdint|stdio|stdlib|stdnoreturn|string|tgmath|threads|time|uchar|wchar|wctype)|algorithm|array|atomic|bitset|chrono|codecvt|complex|condition_variable|deque|exception|execution|filesystem|forward_list|fstream|functional|future|initializer_list|iomanip|ios|iosfwd|iostream|istream|iterator|limits|list|locale|map|memory|mutex|new|numeric|optional|ostream|queue|random|ratio|regex|scoped_allocator|set|shared_mutex|sstream|stack|stdexcept|streambuf|string|string_view|system_error|thread|tuple|type_traits|typeindex|typeinfo|unordered_map|unordered_set|utility|valarray|variant|vector)>'
    Priority:        3
  # 4. Abseil headers
  - Regex:           '^<absl/'
    Priority:        4
  # 5. Other library headers (e.g., OpenCV, yaml-cpp)
  - Regex:           '^<opencv2/|^<yaml-cpp/'
    Priority:        5
  # 6. Project headers
  - Regex:           '^"vvp/'
    Priority:        6
  # Catch-all for remaining quoted includes (should ideally match #1 or #6)
  - Regex:           '^"'
    Priority:        7 # Lowest priority for quoted includes if not matched above
  # Catch-all for remaining angle-bracket includes
  - Regex:           '^<'
    Priority:        8 # Lowest priority for angle includes if not matched above

# Other formatting options (aligning with Google Style)
AlignConsecutiveAssignments: None
AlignConsecutiveDeclarations: None
AlignOperands: Align # Align operators, etc.
AllowShortBlocksOnASingleLine: Never # Always use braces on new lines
AllowShortCaseLabelsOnASingleLine: false
AllowShortFunctionsOnASingleLine: None # Disallow short functions on one line
AllowShortIfStatementsOnASingleLine: Never
AllowShortLoopsOnASingleLine: false
AlwaysBreakAfterReturnType: None
AlwaysBreakBeforeMultilineStrings: false # Prefer not breaking before multiline strings
AlwaysBreakTemplateDeclarations: Yes
BinPackArguments: false # Prefer not bin packing arguments
BinPackParameters: false # Prefer not bin packing parameters
BreakBeforeBinaryOperators: None # Break after binary operators
BreakBeforeTernaryOperators: true
BreakConstructorInitializers: BeforeColon
BreakInheritanceList: BeforeColon
CompactNamespaces: false
FixNamespaceComments: false # Disabled as per Google Style

# Pointer alignment
PointerAlignment: Left
DerivePointerAlignment: false

# Space management
SpaceAfterCStyleCast: true
SpaceAfterTemplateKeyword: true
SpaceBeforeAssignmentOperators: true
SpaceBeforeCpp11BracedList: true # Add space before braced list
SpaceBeforeCtorInitializerColon: true
SpaceBeforeInheritanceColon: true
SpaceBeforeParens: ControlStatements # Only before control statement parens
SpaceBeforeRangeBasedForLoopColon: true
SpaceInEmptyParentheses: false
SpacesBeforeTrailingComments: 2
SpacesInAngles: false
SpacesInCStyleCastParentheses: true
SpacesInContainerLiterals: true # Add spaces in {}
SpacesInParentheses: false
SpacesInSquareBrackets: false

# Force braces for control statements
InsertBraces: true

# Keep comments near code
ReflowComments: true 